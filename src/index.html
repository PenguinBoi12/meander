<!DOCTYPE html>
<html>
    <head>
        <title>Meander</title>

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <meta name="author" content="Simon Roy">
        <meta name="title" content="Meander">

        <link rel="stylesheet" href="styles/base.css">
        
        <script type="text/javascript" src="js/paper/paper-full.js"></script>

        <script type="text/paperscript" canvas="meanderCanvas">
            function getRandomArbitrary(min, max) {
                return Math.random() * (max - min) + min;
            }

            var VIEW_MIDDLE = view.size.width / 2;

            var POINT_COUNT = 30;
            var POINT_DISTANCE = view.size.height / (POINT_COUNT / 2);

            function generateMeander(flow) {
                var path = new Path({
                    strokeColor: '#3EA4F0',
                    strokeWidth: 10,
                    strokeCap: 'round'
                });
                
                for (var i = 0; i < POINT_COUNT; i++) {
                    var x = getRandomArbitrary(VIEW_MIDDLE - flow, VIEW_MIDDLE + flow);
                    var y = i * POINT_DISTANCE;
                    var newPoint = new Point(x, y);

                    path.add(newPoint);
                }

                path.smooth({ type: 'continuous' });
                return path;
            }

            function onFrame(event) {
                if (flow == 0) return null;
                
                for (var i = 1; i < POINT_COUNT - 1; i++) {
                    var segment = meander.segments[i];
                    var sinus = Math.sin(event.time * flow + i);

                    if (segment.point.x < VIEW_MIDDLE) {
                        segment.point.x = (segment.point.x - sinus);
                    } else {
                        segment.point.x = (segment.point.x + sinus);
                    }
                }
                
                meander.smooth();
            }

            var flow = 1; 

            function onKeyUp(event) {
                if (event.key == 'up') {
                    meander.strokeWidth += 10;
                    // flow += 10;
                } else if (event.key == 'down' && flow > 0) {
                    meander.strokeWidth -= 10;
                    // flow -= 10;
                }
                
                for (var i = 0; i < POINT_COUNT; i++) {
                    var segment = meander.segments[i];

                    if (segment.point.x > VIEW_MIDDLE) {
                        segment.point.x = (VIEW_MIDDLE + i) + flow;
                    } else {
                        segment.point.x = (VIEW_MIDDLE - i) - flow;
                    }
                }
                
                meander.smooth();
            }

            var meander = generateMeander(1);
        </script>

    </head>
    <body>
        <div class="grid grid-cols-3 h-screen">
            <div class="flex flex-col col-span-2">
                <p>Canvas</p>
                <canvas class="flex-1" id="meanderCanvas" resize></canvas>
            </div>

            <div class="flex flex-col col-span-1">
                <p>Controls</p>
            </div>
        </div>
    </body>
</html>